<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Tracking</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles/styleSheet.css') }}">
</head>

<body>
    <div class="header">
        <h1>Kettering University Pizza Shop</h1>
    </div>

    <div class="tracking-container">
        <button class="track-order-btn">Track Your Order</button>
        <div class="progress-bar">
            <div class="progress"></div>
            <div class="progress-indicator"></div>
        </div>
        <div class="order-status">
            <p id="orderStatus"></p>
        </div>
        <div class="order-info">
            <h3>Order Information</h3>
            <h4 id="order_id" name="order_id">{{order_id}}</h4>
            <p id="order" name="order"></p>

        </div>
    </div>
    <div class="logout-btn-container">
        <form action="{{ url_for('logout')}}" onsubmit="return confirm('Are you sure you want to leave tracking?');">
            <button name="logout" id = "logout" type="submit" class="logout-btn">Return to Main Menu</button>
        </form>
    </div>  
    <script>
        var progress = document.documentElement;
        var progressBall = document.documentElement;
        var i = 0;

        function changeProgress() {

            i++;

            switch (i) {
                case 1:
                    progress.style.setProperty('--progress', '0%');
                    progressBall.style.setProperty('--progressBall', '0%');
                    document.getElementById('orderStatus').innerText = "Your Order has been placed";
                    break;
                case 3:
                    progress.style.setProperty('--progress', '33%');
                    progressBall.style.setProperty('--progressBall', '33%');
                    document.getElementById('orderStatus').innerText = "Your Order is being made";
                    break;
                case 5:
                    progress.style.setProperty('--progress', '50%');
                    progressBall.style.setProperty('--progressBall', '50%');
                    document.getElementById('orderStatus').innerText = "Your Order is being packaged";
                    break;
                case 7:
                    progress.style.setProperty('--progress', '70%');
                    progressBall.style.setProperty('--progressBall', '70%');
                    document.getElementById('orderStatus').innerText = "Your Order is on its way";
                    break;
                case 10:
                    progress.style.setProperty('--progress', '100%');
                    progressBall.style.setProperty('--progressBall', '100%');
                    document.getElementById('orderStatus').innerText = "Your Order is ready";
                    break;
            }

            // Stop the interval once i reaches 10
            if (i >= 10) {
                clearInterval(progressInterval);
            }
        }

        // Call the function periodically to simulate progress
        var progressInterval = setInterval(changeProgress, 5000);  // Update every 5 seconds
        document.addEventListener("DOMContentLoaded", function () {
            changeProgress();
        })

        fetch('/getOrder')
            .then(response => response.json())  // Parse the JSON response
            .then(data => {
                const display = document.getElementById("order");

                //get number of items in the order
                const orderNum = data.items;

                // Assuming the data returned is an object where `order` holds the actual order details
                const orderDetails = data.order;


                // Clear the innerHTML in case of multiple fetches
                display.innerHTML = '';

                const displayPizzas = [];
                // Generate the item numbers in order to iterate through
                for (let i = 0; i < orderNum; i++) {
                    displayPizzas[i] = "Pizza " + (i + 1);
                }

                // Manually define the desired display order for the order object
                const displayOrder = ['size', 'saucecheese', 'meats', 'toppings', 'quantity', 'cost'];

                displayPizzas.forEach(pizza => {
                    // for each item in the orderDetails object, display the key-value pair
                    display.innerHTML += `<strong>${pizza}</strong><br>`;

                    // Loop through the array in the desired order and display each element for each item
                    displayOrder.forEach(parameter => {
                        const value = orderDetails[pizza][parameter];

                        if (Array.isArray(value)) {
                            // If the value is an array, join the elements for display
                            display.innerHTML += `<strong>${parameter}:</strong> ${value.join(', ')}<br>`;
                        } else {
                            if (parameter === 'cost') {
                                // If the parameter is cost, display it as currency
                                display.innerHTML += `<strong>${parameter}:</strong> $${value}<br>`;
                            } else {
                                // Otherwise, display the key-value pair directly
                                display.innerHTML += `<strong>${parameter}:</strong> ${value}<br>`;
                            }
                        }
                    });
                    display.innerHTML += '<br>'; // Add a line break between pizzas
                });
                
                //print orderID and totalCost if they exist
                if (data.totalCost) {
                    //print the totalCost
                    display.innerHTML += `<strong>Total Cost:</strong> $${data.totalCost}`;
                }
            })
    </script>
</body>

</html>